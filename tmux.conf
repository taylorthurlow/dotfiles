# unbind literally all the things
unbind -a -T prefix
unbind -a -T root
unbind -a -T copy-mode
unbind -a -T copy-mode-vi

set -g prefix C-a
set -g mode-keys vi
set -g history-limit 100000
set -s escape-time 1
set -g set-titles on
set -g set-titles-string "#T"
set -g mouse on
set -g base-index 1
set -g pane-base-index 1

set -g status-right ''
set -g status-right-length 0
set -g status-style bg=default
set-window-option -g window-status-current-style bg=white
set-window -g pane-border-lines double
set-window-option -g pane-border-style fg=white
set-window-option -g pane-active-border-style fg=green

bind r source-file ~/.tmux.conf \; display "reloaded tmux.conf"
bind C-d detach
bind ? list-keys
bind Enter command-prompt

# Windows, panes, splits, layout
bind c new-window -a -t '{end}'
bind n select-window -t +
bind p select-window -t -
bind C kill-window
bind 1 select-window -t 1
bind 2 select-window -t 2
bind 3 select-window -t 3
bind 4 select-window -t 4
bind 5 select-window -t 5
bind 6 select-window -t 6
bind 7 select-window -t 7
bind 8 select-window -t 8
bind 9 select-window -t 9
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R
bind z resize-pane -Z
bind -r H resize-pane -L 4
bind -r J resize-pane -D 3
bind -r K resize-pane -U 3
bind -r L resize-pane -R 4
bind    v split-window -h -c "#{pane_current_path}"
bind    s split-window -v -c "#{pane_current_path}"
bind    = select-layout even-vertical
bind    + select-layout tiled

# Restore unbound mouse commands
bind -T root MouseDown1Pane { select-pane -t =; send -M }
bind -n MouseDown1Status select-window -t =
bind -n MouseDown3Pane   if -F -t= "#{mouse_any_flag}" { select-pane -t=; send -M } { select-pane -mt= }
bind -n MouseDrag1Pane   if -F -t= "#{mouse_any_flag}" { if -Ft= "#{pane_in_mode}" { copy-mode -M } { send -M } } { copy-mode -M }
bind -n MouseDrag1Border resize-pane -M
bind -n WheelUpPane      if -F -t= "#{mouse_any_flag}" { send -M } { if -Ft= "#{pane_in_mode}" { send -M } { copy-mode -et= } }
bind -n WheelUpStatus    previous-window
bind -n WheelDownStatus  next-window

# Restore unbound copy-mode mouse commands
bind -T copy-mode-vi MouseDown1Pane    select-pane
bind -T copy-mode-vi MouseDrag1Pane    { select-pane; send -X begin-selection }
bind -T copy-mode-vi MouseDragEnd1Pane send -X copy-pipe-no-clear
bind -T copy-mode-vi WheelUpPane       { select-pane; send -X -N 5 scroll-up }
bind -T copy-mode-vi WheelDownPane     { select-pane; send -X -N 5 scroll-down }
bind -T copy-mode-vi DoubleClick1Pane  { select-pane; send -X select-word }
bind -T copy-mode-vi TripleClick1Pane  { select-pane; send -X select-line }

# Copy mode with keyboard
bind Space copy-mode
bind -T copy-mode-vi Escape send -X cancel
bind -T copy-mode-vi k send -X cursor-up
bind -T copy-mode-vi j send -X cursor-down
bind -T copy-mode-vi h send -X cursor-left
bind -T copy-mode-vi l send -X cursor-right
bind -T copy-mode-vi b send -X previous-word
bind -T copy-mode-vi b send -X next-word
bind -T copy-mode-vi b send -X next-word-end
bind -T copy-mode-vi b send -X 
bind -T copy-mode-vi b send -X
bind -T copy-mode-vi b send -X
bind -T copy-mode-vi b send -X
bind -T copy-mode-vi b send -X
bind -T copy-mode-vi b send -X 
bind -T copy-mode-vi b send -X 
bind -T copy-mode-vi v  if -F "#{selection_present}" { send -X clear-selection } { send -X begin-selection }
bind -T copy-mode-vi y      send -X copy-selection-no-clear
bind -T copy-mode-vi Enter  send -X copy-selection-and-cancel
bind -n WheelUpPane copy-mode -e
bind -T copy-mode-vi WheelUpPane   send -X -N 5 scroll-up
bind -T copy-mode-vi WheelDownPane send -X -N 5 scroll-down


# Copy mode with mouse
bind -n MouseDrag1Pane copy-mode -M
bind -T copy-mode-vi MouseDrag1Pane    send -X begin-selection
bind -T copy-mode-vi MouseDragEnd1Pane send -X copy-selection-no-clear

# Jumping by prompts
# https://github.com/ianthehenry/dotfiles/blob/9a51586f15469ac44e3ae0492386a3a2f32337b8/.tmux.conf
bind -n M-k {
  copy-mode
  send -X start-of-line
  send -X search-backward-text "$>\u00A0"
  send -X start-of-line
  send -X search-forward-text "$>\u00A0"
  send -X stop-selection
  send -X -N 3 cursor-right
}
bind -n M-j {
  copy-mode
  send -X start-of-line
  send -X search-forward-text "$>\u00A0"
  send -X stop-selection
  send -X -N 3 cursor-right
}

# Select entire prompt results
# https://github.com/ianthehenry/dotfiles/blob/9a51586f15469ac44e3ae0492386a3a2f32337b8/.tmux.conf
bind -n S-M-Up {
  copy-mode
  send -X clear-selection
  send -X start-of-line
  send -X start-of-line
  send -X cursor-up
  send -X start-of-line
  send -X start-of-line

  if -F "#{m:*$>\u00A0*,#{copy_cursor_line}}" {
    send -X search-forward-text "$>\u00A0"
    send -X stop-selection
    send -X -N 2 cursor-right
    send -X begin-selection
    send -X end-of-line
    send -X end-of-line

    if "#{m:*$>\u00A0?*,#{copy_cursor_line}}" {
      send -X cursor-left
    }
  } {
    send -X end-of-line
    send -X end-of-line
    send -X begin-selection
    send -X search-backward-text "$>\u00A0"
    send -X end-of-line
    send -X end-of-line
    send -X cursor-right
    send -X stop-selection
  }
}

bind -n S-M-Down {
  copy-mode
  send -X clear-selection

  send -X end-of-line
  send -X end-of-line
  send -X cursor-right

  if -F "#{m:*$>\u00A0*,#{copy_cursor_line}}" {
    send -X search-forward-text "$>\u00A0"
    send -X stop-selection
    send -X -N 2 cursor-right
    send -X begin-selection
    send -X end-of-line
    send -X end-of-line

    if "#{m:*$>\u00A0?*,#{copy_cursor_line}}" {
      send -X cursor-left
    }
  } {
    send -X begin-selection
    send -X search-forward-text "$>\u00A0"
    send -X start-of-line
    send -X start-of-line
    send -X cursor-left
    send -X stop-selection
  }
}

# Copy line
bind M-Enter {
  copy-mode

  send -X cursor-up
  send -X start-of-line
  send -X start-of-line
  send -X begin-selection
  send -X end-of-line
  send -X end-of-line
  send -X cursor-left
  send -X copy-pipe-and-cancel "sed -E 's/^ *| *$//g' | pbcopy"
}
